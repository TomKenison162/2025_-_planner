
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive Financial Dashboard with Visualizations</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Lighter gray background */
        }
        .metric-value.positive { color: #16a34a; }
        .metric-value.negative { color: #dc2626; }
        input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.4);
        }
        /* Style for the collapsible details/summary element */
        summary {
            transition: margin 0.2s ease-in-out;
        }
        details[open] > summary {
            margin-bottom: 0.75rem;
        }
        /* Container for charts to maintain aspect ratio */
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
    </style>
</head>
<body class="p-4 md:p-8 text-gray-800">

    <div class="max-w-screen-2xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">Comprehensive Financial Dashboard üìä</h1>
            <p class="text-lg text-gray-600 mt-2">Model your academic year finances. All data is saved locally in your browser.</p>
        </header>

        <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
            
            <div class="xl:col-span-1 bg-white p-6 rounded-2xl shadow-lg space-y-4 self-start">
                <div class="flex justify-between items-center border-b pb-3 mb-4">
                    <h2 class="text-2xl font-bold text-gray-800">Your Financial Inputs</h2>
                    <button id="clearDataBtn" class="text-sm text-indigo-600 hover:text-indigo-800 font-semibold">Clear All Data</button>
                </div>
                
                <details open class="space-y-4">
                    <summary class="font-semibold text-lg cursor-pointer list-disc list-inside">üí∞ Income & Capital</summary>
                    <div class="pl-4 border-l-2 border-gray-200 space-y-4 pt-2">
                        <div>
                            <label for="payRate" class="block text-sm font-medium text-gray-700">Pay Rate (¬£/hour)</label>
                            <input type="number" id="payRate" placeholder="e.g., 12.50" step="0.01" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
                        </div>
                        <div>
                            <label for="workHours" class="block text-sm font-medium text-gray-700">Weekly Work Hours</label>
                            <input type="number" id="workHours" placeholder="e.g., 15" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
                        </div>
                         <div>
                            <label for="maintenanceLoan" class="block text-sm font-medium text-gray-700">Annual Maintenance Loan (¬£)</label>
                            <input type="number" id="maintenanceLoan" placeholder="e.g., 9000" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
                        </div>
                        <div>
                            <label for="initialChecking" class="block text-sm font-medium text-gray-700">Starting Cash Balance (¬£)</label>
                            <input type="number" id="initialChecking" placeholder="e.g., 2500" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
                        </div>
                    </div>
                </details>

                <details open class="space-y-4">
                    <summary class="font-semibold text-lg cursor-pointer list-disc list-inside">üí∏ Expenses</summary>
                     <div class="pl-4 border-l-2 border-gray-200 space-y-4 pt-2">
                        <div>
                            <label for="rent" class="block text-sm font-medium text-gray-700">Monthly Rent (¬£)</label>
                            <input type="number" id="rent" placeholder="e.g., 750" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
                        </div>
                        <div>
                            <label for="bills" class="block text-sm font-medium text-gray-700">Your Monthly Bills Share (¬£)</label>
                            <input type="number" id="bills" placeholder="e.g., 80" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
                        </div>
                        <div>
                            <label for="weeklyLivingBudget" class="block text-sm font-medium text-gray-700">Weekly Living Budget (¬£)</label>
                            <input type="number" id="weeklyLivingBudget" placeholder="e.g., 100" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
                        </div>
                         <div>
                            <label for="oneOffExpenses" class="block text-sm font-medium text-gray-700">Planned One-Off Expenses (¬£)</label>
                            <input type="number" id="oneOffExpenses" placeholder="e.g., 1200" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
                        </div>
                    </div>
                </details>

                <details open class="space-y-4">
                    <summary class="font-semibold text-lg cursor-pointer list-disc list-inside">üìà Investments</summary>
                    <div class="pl-4 border-l-2 border-gray-200 space-y-4 pt-2">
                        <div>
                            <label for="initialInvestmentValue" class="block text-sm font-medium text-gray-700">Initial Investment Value (¬£)</label>
                            <input type="number" id="initialInvestmentValue" placeholder="e.g., 40000" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
                        </div>
                         <div>
                            <label for="expectedGrowth" class="block text-sm font-medium text-gray-700">Expected Annual Growth (%)</label>
                            <input type="number" id="expectedGrowth" placeholder="e.g., 7" step="0.1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
                        </div>
                        <div>
                            <label for="fundFee" class="block text-sm font-medium text-gray-700">Investment Fund Fee (%)</label>
                            <input type="number" id="fundFee" placeholder="e.g., 0.9" step="0.01" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
                        </div>
                    </div>
                </details>

                <details class="space-y-4">
                    <summary class="font-semibold text-lg cursor-pointer list-disc list-inside">‚öôÔ∏è Model Configuration</summary>
                    <div class="pl-4 border-l-2 border-gray-200 space-y-4 pt-2">
                         <div>
                            <label for="academicWeeks" class="block text-sm font-medium text-gray-700">Weeks in Academic Year</label>
                            <input type="number" id="academicWeeks" value="39" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-gray-50">
                        </div>
                        <div>
                            <label for="rentMonths" class="block text-sm font-medium text-gray-700">Months of Rent Payable</label>
                            <input type="number" id="rentMonths" value="11" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-gray-50">
                        </div>
                    </div>
                </details>
            </div>

            <div class="xl:col-span-2 space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white p-5 rounded-2xl shadow-lg">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-3">üóìÔ∏è Annual Financial Overview</h3>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between"><span>Projected Job Income:</span> <span id="out-annualJobIncome" class="font-semibold"></span></div>
                            <div class="flex justify-between"><span>Maintenance Loan:</span> <span id="out-maintenanceLoan" class="font-semibold"></span></div>
                            <div class="flex justify-between font-bold text-base pt-2 border-t"><span>Total Annual Income:</span> <span id="out-totalAnnualIncome" class="font-semibold"></span></div>
                            <div class="flex justify-between text-red-600"><span>Total Annual Expenses:</span> <span id="out-totalAnnualExpenses" class="font-semibold"></span></div>
                            <div class="flex justify-between font-bold text-base pt-2 border-t"><span>Annual Surplus / Deficit:</span> <span id="out-annualSurplus" class="font-semibold metric-value"></span></div>
                        </div>
                    </div>
                    <div class="bg-white p-5 rounded-2xl shadow-lg">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-3">üí≥ Annual Expense Breakdown</h3>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between"><span>Housing (Rent & Bills):</span> <span id="out-annualHousingCosts" class="font-semibold"></span></div>
                            <div class="flex justify-between"><span>General Living Costs:</span> <span id="out-annualLivingCosts" class="font-semibold"></span></div>
                            <div class="flex justify-between"><span>One-Off Expenses:</span> <span id="out-oneOffExpenses" class="font-semibold"></span></div>
                            <div class="flex justify-between font-bold text-base pt-2 border-t"><span>Total Annual Expenses:</span> <span id="out-totalAnnualExpenses2" class="font-semibold text-red-600"></span></div>
                        </div>
                    </div>
                     <div class="bg-white p-5 rounded-2xl shadow-lg">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-3">üåä Cash Flow Analysis</h3>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between"><span>Weekly Income (Job):</span> <span id="out-weeklyIncome" class="font-semibold"></span></div>
                            <div class="flex justify-between"><span>Weekly Spend (Living):</span> <span id="out-weeklyLivingSpend" class="font-semibold"></span></div>
                            <div class="flex justify-between"><span>Average Monthly Spend:</span> <span id="out-monthlyBurn" class="font-semibold"></span></div>
                            <div class="flex justify-between pt-2 border-t"><span>Starting Cash Balance:</span> <span id="out-startCash" class="font-semibold"></span></div>
                            <div class="flex justify-between font-bold text-base"><span>Projected End of Year Cash:</span> <span id="out-eoyCash" class="font-semibold metric-value"></span></div>
                        </div>
                    </div>
                     <div class="bg-white p-5 rounded-2xl shadow-lg">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-3">üíπ Investment Performance</h3>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between"><span>Initial Value:</span> <span id="out-startInvestments" class="font-semibold"></span></div>
                            <div class="flex justify-between"><span>Gross Growth (%):</span> <span id="out-grossGrowthPercent" class="font-semibold"></span></div>
                             <div class="flex justify-between"><span>Net Growth Rate (%):</span> <span id="out-netGrowthPercent" class="font-semibold"></span></div>
                            <div class="flex justify-between pt-2 border-t"><span>Est. Gross Growth (¬£):</span> <span id="out-grossGrowthValue" class="font-semibold"></span></div>
                             <div class="flex justify-between"><span>Est. Fund Fees (¬£):</span> <span id="out-fundFeeValue" class="font-semibold text-red-600"></span></div>
                             <div class="flex justify-between font-bold text-base"><span>Net Investment Growth (¬£):</span> <span id="out-netGrowthValue" class="font-semibold metric-value"></span></div>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-5 rounded-2xl shadow-lg">
                     <h3 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-3">‚ú® Net Worth Summary</h3>
                     <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center mb-6">
                        <div>
                            <p class="text-sm text-gray-500">Starting Net Worth</p>
                            <p id="out-startNetWorth" class="text-2xl font-bold"></p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">Projected EOY Net Worth</p>
                            <p id="out-eoyNetWorth" class="text-2xl font-bold metric-value"></p>
                        </div>
                         <div>
                            <p class="text-sm text-gray-500">Change This Year</p>
                            <p id="out-netWorthChange" class="text-2xl font-bold metric-value"></p>
                        </div>
                     </div>
                     <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 pt-4 border-t">
                         <div>
                            <h4 class="text-lg font-semibold text-center mb-2">Annual Expense Breakdown</h4>
                            <div class="chart-container"><canvas id="expenseChart"></canvas></div>
                         </div>
                         <div>
                            <h4 class="text-lg font-semibold text-center mb-2">Income vs. Expenses</h4>
                            <div class="chart-container"><canvas id="incomeExpenseChart"></canvas></div>
                         </div>
                         <div class="lg:col-span-2">
                             <h4 class="text-lg font-semibold text-center mb-2">Projected Net Worth Journey</h4>
                             <div class="chart-container" style="height: 250px;"><canvas id="netWorthChart"></canvas></div>
                         </div>
                     </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const allInputs = document.querySelectorAll('input[type="number"]');
        
        let expenseChart, incomeExpenseChart, netWorthChart;

        // --- Caching Logic ---
        function saveToCache() {
            allInputs.forEach(input => {
                localStorage.setItem(input.id, input.value);
            });
        }

        function loadFromCache() {
            allInputs.forEach(input => {
                const savedValue = localStorage.getItem(input.id);
                if (savedValue !== null) {
                    input.value = savedValue;
                }
            });
        }

        function clearCache() {
            if (confirm('Are you sure you want to clear all saved data? This cannot be undone.')) {
                allInputs.forEach(input => {
                    // Only clear non-config inputs
                    if (!input.classList.contains('bg-gray-50')) {
                         localStorage.removeItem(input.id);
                         input.value = '';
                    }
                });
                calculate();
            }
        }
        
        document.getElementById('clearDataBtn').addEventListener('click', clearCache);

        // --- Main Calculation Logic ---
        function calculate() {
            // Get all input values, defaulting to 0 if empty
            const payRate = parseFloat(document.getElementById('payRate').value) || 0;
            const workHours = parseFloat(document.getElementById('workHours').value) || 0;
            const maintenanceLoan = parseFloat(document.getElementById('maintenanceLoan').value) || 0;
            const initialChecking = parseFloat(document.getElementById('initialChecking').value) || 0;
            
            const rent = parseFloat(document.getElementById('rent').value) || 0;
            const bills = parseFloat(document.getElementById('bills').value) || 0;
            const weeklyLivingBudget = parseFloat(document.getElementById('weeklyLivingBudget').value) || 0;
            const oneOffExpenses = parseFloat(document.getElementById('oneOffExpenses').value) || 0;

            const initialInvestmentValue = parseFloat(document.getElementById('initialInvestmentValue').value) || 0;
            const expectedGrowth = parseFloat(document.getElementById('expectedGrowth').value) || 0;
            const fundFee = parseFloat(document.getElementById('fundFee').value) || 0;

            const academicWeeks = parseFloat(document.getElementById('academicWeeks').value) || 39;
            const rentMonths = parseFloat(document.getElementById('rentMonths').value) || 11;

            // --- CALCULATIONS ---

            // 1. Income Calculations
            const weeklyIncome = payRate * workHours;
            const annualJobIncome = weeklyIncome * academicWeeks;
            const totalAnnualIncome = annualJobIncome + maintenanceLoan;

            // 2. Expense Calculations
            const annualHousingCosts = (rent + bills) * rentMonths;
            const annualLivingCosts = weeklyLivingBudget * academicWeeks;
            const totalAnnualExpenses = annualHousingCosts + annualLivingCosts + oneOffExpenses;
            const monthlyBurn = totalAnnualExpenses / 12;

            // 3. Cash Flow & Surplus/Deficit
            const annualSurplus = totalAnnualIncome - totalAnnualExpenses;
            const eoyCash = initialChecking + annualSurplus;
            
            // 4. Investment Calculations
            const netGrowthRate = expectedGrowth - fundFee;
            const grossGrowthValue = initialInvestmentValue * (expectedGrowth / 100);
            const fundFeeValue = initialInvestmentValue * (fundFee / 100);
            const netInvestmentGrowth = initialInvestmentValue * (netGrowthRate / 100);
            const eoyInvestments = initialInvestmentValue + netInvestmentGrowth;

            // 5. Net Worth Calculations
            const startNetWorth = initialChecking + initialInvestmentValue;
            const eoyNetWorth = eoyCash + eoyInvestments;
            const netWorthChange = eoyNetWorth - startNetWorth;

            // --- UI Update ---
            const formatCurrency = (val) => val.toLocaleString('en-GB', { style: 'currency', currency: 'GBP', minimumFractionDigits: 0, maximumFractionDigits: 0 });
            const formatPercent = (val) => `${val.toFixed(2)}%`;
            
            const updateMetric = (id, value, formatter = formatCurrency, checkSign = false) => {
                const el = document.getElementById(id);
                if (!el) return;
                el.textContent = formatter(value);
                if (checkSign) {
                    el.classList.toggle('positive', value >= 0);
                    el.classList.toggle('negative', value < 0);
                }
            };
            
            // Annual Overview Box
            updateMetric('out-annualJobIncome', annualJobIncome);
            updateMetric('out-maintenanceLoan', maintenanceLoan);
            updateMetric('out-totalAnnualIncome', totalAnnualIncome);
            updateMetric('out-totalAnnualExpenses', totalAnnualExpenses);
            updateMetric('out-annualSurplus', annualSurplus, formatCurrency, true);
            
            // Expense Breakdown Box
            updateMetric('out-annualHousingCosts', annualHousingCosts);
            updateMetric('out-annualLivingCosts', annualLivingCosts);
            updateMetric('out-oneOffExpenses', oneOffExpenses);
            updateMetric('out-totalAnnualExpenses2', totalAnnualExpenses);
            
            // Cash Flow Box
            updateMetric('out-weeklyIncome', weeklyIncome);
            updateMetric('out-weeklyLivingSpend', weeklyLivingBudget);
            updateMetric('out-monthlyBurn', monthlyBurn);
            updateMetric('out-startCash', initialChecking);
            updateMetric('out-eoyCash', eoyCash, formatCurrency, true);

            // Investment Box
            updateMetric('out-startInvestments', initialInvestmentValue);
            updateMetric('out-grossGrowthPercent', expectedGrowth, formatPercent);
            updateMetric('out-netGrowthPercent', netGrowthRate, formatPercent);
            updateMetric('out-grossGrowthValue', grossGrowthValue);
            updateMetric('out-fundFeeValue', fundFeeValue);
            updateMetric('out-netGrowthValue', netInvestmentGrowth, formatCurrency, true);

            // Net Worth Summary
            updateMetric('out-startNetWorth', startNetWorth);
            updateMetric('out-eoyNetWorth', eoyNetWorth, formatCurrency, true);
            updateMetric('out-netWorthChange', netWorthChange, formatCurrency, true);

            // Update charts with new data
            updateCharts({
                annualHousingCosts,
                annualLivingCosts,
                oneOffExpenses,
                totalAnnualIncome,
                totalAnnualExpenses,
                startNetWorth,
                eoyNetWorth
            });

            // Save valid inputs to cache after calculation
            saveToCache();
        }

        // --- Charting Logic ---
        function updateCharts(data) {
            const chartFont = { size: 12, family: 'Inter' };
            const commonPlugins = {
                legend: { labels: { font: chartFont } },
                tooltip: { bodyFont: chartFont, titleFont: chartFont }
            };

            // 1. Expense Chart (Doughnut)
            const expenseData = {
                labels: ['Housing & Bills', 'General Living', 'One-Off Expenses'],
                datasets: [{
                    label: 'Annual Expenses',
                    data: [data.annualHousingCosts, data.annualLivingCosts, data.oneOffExpenses],
                    backgroundColor: ['#3b82f6', '#f97316', '#ef4444'],
                    borderColor: '#ffffff',
                    borderWidth: 2,
                }]
            };
            if (expenseChart) {
                expenseChart.data = expenseData;
                expenseChart.update();
            } else {
                expenseChart = new Chart(document.getElementById('expenseChart'), {
                    type: 'doughnut',
                    data: expenseData,
                    options: { responsive: true, maintainAspectRatio: false, plugins: commonPlugins }
                });
            }

            // 2. Income vs. Expense Chart (Bar)
            const incomeExpenseData = {
                labels: ['Annual Figures'],
                datasets: [
                    { label: 'Total Income', data: [data.totalAnnualIncome], backgroundColor: '#16a34a' },
                    { label: 'Total Expenses', data: [data.totalAnnualExpenses], backgroundColor: '#dc2626' }
                ]
            };
            if (incomeExpenseChart) {
                incomeExpenseChart.data = incomeExpenseData;
                incomeExpenseChart.update();
            } else {
                incomeExpenseChart = new Chart(document.getElementById('incomeExpenseChart'), {
                    type: 'bar',
                    data: incomeExpenseData,
                    options: { responsive: true, maintainAspectRatio: false, plugins: commonPlugins }
                });
            }
            
            // 3. Net Worth Chart (Line)
            const netWorthData = {
                labels: ['Start of Year', 'End of Year'],
                datasets: [{
                    label: 'Projected Net Worth',
                    data: [data.startNetWorth, data.eoyNetWorth],
                    fill: true,
                    borderColor: '#8b5cf6',
                    backgroundColor: 'rgba(139, 92, 246, 0.1)',
                    tension: 0.1
                }]
            };
             if (netWorthChart) {
                netWorthChart.data = netWorthData;
                netWorthChart.update();
            } else {
                netWorthChart = new Chart(document.getElementById('netWorthChart'), {
                    type: 'line',
                    data: netWorthData,
                    options: { responsive: true, maintainAspectRatio: false, plugins: commonPlugins }
                });
            }
        }

        // Add event listeners and run initial calculation
        allInputs.forEach(input => {
            input.addEventListener('input', calculate);
        });

        window.addEventListener('DOMContentLoaded', () => {
            loadFromCache();
            calculate();
        });

    </script>
</body>
</html>
```
